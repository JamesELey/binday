<!DOCTYPE html>
<html>
<head>
    <title>Debug Areas Map Data</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #debug { background: #f5f5f5; padding: 20px; margin: 20px 0; border-radius: 5px; }
        pre { background: #fff; padding: 10px; border-radius: 3px; overflow-x: auto; }
        #map { height: 400px; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>üîç Debug Areas Map Data</h1>
    
    <div id="debug">
        <h3>Loading areas data...</h3>
        <div id="results"></div>
    </div>
    
    <div id="map"></div>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        async function debugAreas() {
            const resultsDiv = document.getElementById('results');
            
            try {
                // Fetch areas data
                const response = await fetch('/api/areas');
                const data = await response.json();
                
                resultsDiv.innerHTML = `
                    <h4>‚úÖ Areas API Response:</h4>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                    
                    <h4>üìä Analysis:</h4>
                    <ul>
                        <li><strong>Total areas:</strong> ${data.areas ? data.areas.length : 0}</li>
                        <li><strong>Polygon areas:</strong> ${data.areas ? data.areas.filter(a => a.type === 'polygon').length : 0}</li>
                        <li><strong>Areas with coordinates:</strong> ${data.areas ? data.areas.filter(a => a.coordinates && a.coordinates.length > 0).length : 0}</li>
                    </ul>
                    
                    <h4>üó∫Ô∏è Polygon Areas Details:</h4>
                `;
                
                if (data.areas) {
                    const polygonAreas = data.areas.filter(a => a.type === 'polygon');
                    polygonAreas.forEach(area => {
                        resultsDiv.innerHTML += `
                            <div style="border: 1px solid #ddd; padding: 10px; margin: 10px 0; border-radius: 3px;">
                                <strong>${area.name}</strong> (ID: ${area.id})<br>
                                Type: ${area.type}<br>
                                Active: ${area.active ? 'Yes' : 'No'}<br>
                                Has coordinates: ${area.coordinates ? 'Yes (' + area.coordinates.length + ' points)' : 'No'}<br>
                                ${area.coordinates ? '<details><summary>View coordinates</summary><pre>' + JSON.stringify(area.coordinates, null, 2) + '</pre></details>' : ''}
                            </div>
                        `;
                    });
                }
                
                // Try to render on map
                initMap(data.areas || []);
                
            } catch (error) {
                resultsDiv.innerHTML = `
                    <h4>‚ùå Error:</h4>
                    <pre>${error.message}</pre>
                `;
            }
        }
        
        function initMap(areas) {
            const map = L.map('map').setView([52.8586, -2.2524], 13);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);
            
            const areasGroup = L.layerGroup().addTo(map);
            
            areas.forEach(area => {
                if (area.type === 'polygon' && area.coordinates && area.coordinates.length > 0) {
                    try {
                        console.log('Rendering polygon for area:', area.name, area.coordinates);
                        
                        const polygon = L.polygon(area.coordinates, {
                            color: area.active ? '#28a745' : '#6c757d',
                            fillColor: area.active ? '#28a745' : '#6c757d',
                            fillOpacity: 0.2,
                            weight: 2
                        }).addTo(areasGroup);
                        
                        polygon.bindPopup(`
                            <strong>${area.name}</strong><br/>
                            ${area.description || ''}<br/>
                            <small>Status: ${area.active ? 'Active' : 'Inactive'}</small><br/>
                            <small>Type: Polygon Area</small><br/>
                            <small>Points: ${area.coordinates.length}</small>
                        `);
                        
                        console.log('Successfully rendered polygon for:', area.name);
                    } catch (error) {
                        console.error('Error rendering polygon for', area.name, ':', error);
                        document.getElementById('results').innerHTML += `
                            <div style="color: red; margin: 10px 0;">
                                ‚ùå Failed to render polygon for <strong>${area.name}</strong>: ${error.message}
                            </div>
                        `;
                    }
                }
            });
        }
        
        // Start debugging
        debugAreas();
    </script>
</body>
</html>
